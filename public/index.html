<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1e1e2e">
    <meta name="description" content="A fast, simple, self-hosted, no-nonsense app for running a media server.">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192x192.png">
    <title>Raikiri Media</title>
    <link rel="stylesheet" href="/static/css/inter.css">
    <script src="/static/js/tailwindcss.js"></script>
    <script src="/static/js/lucide.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        base: '#1e1e2e', mantle: '#181825', crust: '#11111b',
                        text: '#cdd6f4', subtext0: '#a6adc8', subtext1: '#bac2de',
                        surface0: '#313244', surface1: '#45475a', surface2: '#585b70',
                        overlay0: '#6c7086', overlay1: '#7f849c',
                        blue: '#89b4fa', lavender: '#b4befe', sapphire: '#74c7ec',
                        mauve: '#cba6f7', red: '#f38ba8', green: '#a6e3a1',
                        yellow: '#f9e2af', pink: '#f5c2e7', flamingo: '#f2cdcd'
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        body { -webkit-tap-highlight-color: transparent; font-family: 'Inter', sans-serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .mask-fade { mask-image: linear-gradient(to right, black 90%, transparent 100%); }
        input[type=range] { -webkit-appearance: none; appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 12px; width: 12px;
            border-radius: 50%; background: #cba6f7; cursor: pointer; margin-top: -5px;
            box-shadow: 0 0 0 2px #1e1e2e; transition: transform 0.1s;
        }
        input[type=range]:hover::-webkit-slider-thumb { transform: scale(1.2); }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 2px; cursor: pointer; background: #45475a; border-radius: 99px;
        }
        #ep-range-wrapper, #ep-range-wrapper-mob {
            position: relative; flex: 1; min-width: 0; height: 2px; background: #45475a; border-radius: 99px;
        }
        #ep-range-fill, #ep-range-fill-mob {
            position: absolute; left: 0; top: 0; height: 100%; background: #cba6f7; border-radius: 99px; pointer-events: none; width: 0%;
        }
        #ep-range, #ep-range-mob {
            position: absolute; left: 0; top: 50%; transform: translateY(-50%); width: 100%; height: 12px; z-index: 1; margin: 0; padding: 0; cursor: pointer;
        }
        #fv-range-wrapper {
            position: relative; flex: 1; min-width: 0; height: 3px; background: rgba(255,255,255,0.3); border-radius: 99px;
        }
        #fv-range-fill {
            position: absolute; left: 0; top: 0; height: 100%; background: #cba6f7; border-radius: 99px; pointer-events: none; width: 0%;
        }
        #fv-range {
            position: absolute; left: 0; top: 50%; transform: translateY(-50%); width: 100%; height: 14px; z-index: 1; margin: 0; padding: 0; cursor: pointer; background: transparent;
        }
        #fv-controls {
            transition: opacity 0.2s ease;
        }
        #fv-controls.fv-hidden {
            opacity: 0;
            pointer-events: none;
        }
        .view-grid {
            display: grid;
            /* Bigger icons: min 160px */
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 1.5rem 1rem;
            align-items: start;
        }
        .view-list { display: flex; flex-direction: column; gap: 0.25rem; }
        
        #queue-dialog { z-index: 60; }
        #subtitle-dialog { z-index: 60; }
    </style>
</head>
<body class="bg-base text-text h-screen w-screen overflow-hidden flex flex-col select-none">

    <header class="flex flex-col md:flex-row md:items-center justify-between px-4 md:px-6 py-2 md:py-0 md:h-16 shrink-0 relative z-30 bg-base border-b border-transparent transition-colors duration-300 gap-2">
        <div class="flex items-center justify-between w-full md:w-auto">
            <div class="flex items-center gap-2 w-32">
                <img src="/logo.png" alt="Raikiri" class="w-8 h-8 rounded-lg">
            </div>
            <div class="md:hidden flex bg-surface0 p-1 rounded-full items-center shadow-lg">
                <button onclick="app.switchTab('files')" id="tab-files-mob" class="w-16 py-1 rounded-full text-xs font-bold transition-all bg-mauve text-base shadow-sm">Media</button>
                <button onclick="app.switchTab('music')" id="tab-music-mob" class="w-16 py-1 rounded-full text-xs font-bold transition-all text-subtext0 hover:text-text">Music</button>
            </div>
        </div>

        <div class="hidden md:flex absolute left-1/2 -translate-x-1/2 bg-surface0 p-1 rounded-full items-center shadow-lg">
            <button onclick="app.switchTab('files')" id="tab-files" class="w-20 py-1.5 rounded-full text-xs font-bold transition-all bg-mauve text-base shadow-sm">Media</button>
            <button onclick="app.switchTab('music')" id="tab-music" class="w-20 py-1.5 rounded-full text-xs font-bold transition-all text-subtext0 hover:text-text">Music</button>
        </div>

        <div class="flex items-center justify-between md:justify-end gap-2 w-full md:w-auto">
             <div class="relative flex-1 md:flex-none md:w-48">
                <i data-lucide="search" size="16" class="absolute left-3 top-1/2 -translate-y-1/2 text-subtext0"></i>
                <input type="text" id="search-input" placeholder="Search..." class="w-full bg-surface0 text-sm text-text rounded-full pl-9 pr-4 py-1.5 focus:outline-none focus:ring-1 focus:ring-mauve placeholder:text-overlay0">
            </div>

            <div class="flex items-center gap-1">
                 <label class="p-2 text-subtext0 hover:text-mauve hover:bg-surface0 rounded-lg transition-colors cursor-pointer" title="Upload">
                    <i data-lucide="upload" size="20"></i>
                    <input type="file" id="file-upload" multiple class="hidden">
                </label>
                <button onclick="queue.shuffleCurrentPath()" class="p-2 text-subtext0 hover:text-mauve hover:bg-surface0 rounded-lg transition-colors" title="Shuffle">
                    <i data-lucide="shuffle" size="20"></i>
                </button>
                <button onclick="app.toggleView()" id="view-toggle" class="p-2 text-subtext0 hover:text-mauve hover:bg-surface0 rounded-lg transition-colors" title="View">
                    <i id="view-toggle-icon" data-lucide="layout-grid" size="20"></i>
                </button>
            </div>
        </div>
    </header>

    <div id="sub-header" class="px-4 md:px-6 py-3 flex items-center shrink-0 min-h-[48px]"></div>
    <main id="main-container" class="flex-1 overflow-y-auto p-4 md:px-6 pb-32 no-scrollbar view-grid">
    </main>

    <div id="queue-dialog" class="fixed inset-0 bg-black/50 hidden flex items-center justify-center p-4 backdrop-blur-sm" onclick="ui.toggleQueueDialog()">
        <div class="bg-mantle w-full max-w-md max-h-[70vh] rounded-2xl shadow-2xl flex flex-col overflow-hidden border border-surface1" onclick="event.stopPropagation()">
            <div class="p-4 border-b border-surface0 flex justify-between items-center bg-base">
                <span class="font-bold">Current Queue</span>
                <button onclick="ui.toggleQueueDialog()"><i data-lucide="x" size="20"></i></button>
            </div>
            <div id="queue-list-container" class="overflow-y-auto p-2 flex-1 space-y-1"></div>
        </div>
    </div>

    <div id="subtitle-dialog" class="fixed inset-0 bg-black/50 hidden flex items-center justify-center p-4 backdrop-blur-sm" onclick="ui.toggleSubtitleDialog()">
        <div class="bg-mantle w-full max-w-sm rounded-2xl shadow-2xl flex flex-col overflow-hidden border border-surface1" onclick="event.stopPropagation()">
            <div class="p-4 border-b border-surface0 flex justify-between items-center bg-base">
                <span class="font-bold">Subtitles</span>
                <button onclick="ui.toggleSubtitleDialog()"><i data-lucide="x" size="20"></i></button>
            </div>
            <div id="subtitle-list-container" class="p-4 space-y-2"></div>
        </div>
    </div>

    <div id="player-bar" class="fixed bottom-0 left-0 right-0 h-16 md:h-20 bg-mantle/95 backdrop-blur-xl border-t border-white/5 z-40 translate-y-full transition-transform duration-300 flex flex-col shadow-[0_-4px_20px_rgba(0,0,0,0.2)] overflow-hidden">
        <div id="pb-progress-container" class="w-full h-1 bg-surface0 cursor-pointer group relative" onclick="ui.handlePlayerBarSeek(event)">
            <div id="pb-progress" class="h-full bg-mauve w-0 relative transition-all duration-100 ease-linear"></div>
        </div>

        <div class="flex-1 flex items-center justify-between px-4">
            <div class="flex items-center gap-3 w-1/2 md:w-1/3 cursor-pointer group overflow-hidden" onclick="ui.toggleExpanded()">
                <div class="hidden md:block w-12 h-12 rounded-lg overflow-hidden relative shadow-md shrink-0 bg-surface1">
                    <!-- Icon Fallback Layer -->
                    <div class="absolute inset-0 flex items-center justify-center text-overlay0 z-0">
                        <i id="pb-fallback-icon" data-lucide="music" size="20"></i>
                    </div>
                    <!-- Image Layer -->
                    <img id="pb-thumb" src="" class="absolute inset-0 w-full h-full object-cover z-10 transition-opacity duration-300" onerror="this.style.opacity='0'">
                    
                    <div class="absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity z-20">
                        <i data-lucide="maximize-2" size="18" class="text-white"></i>
                    </div>
                </div>
                <div class="min-w-0 flex flex-col justify-center">
                    <span id="pb-title" class="text-sm font-bold text-text truncate">Not Playing</span>
                    <span id="pb-meta" class="text-xs text-subtext0 truncate hidden md:block">Artist / Album</span>
                </div>
            </div>

            <div class="flex items-center gap-4 md:gap-6 justify-center w-auto md:w-1/3">
                <button onclick="player.prev()" class="hidden md:block text-subtext0 hover:text-text hover:scale-110 transition-all"><i data-lucide="skip-back" size="22" class="fill-current"></i></button>
                <button onclick="player.toggle()" class="text-text hover:scale-110 transition-all">
                    <i id="pb-play-icon" data-lucide="play" size="28" class="fill-current"></i>
                </button>
                <button onclick="player.next()" class="text-subtext0 hover:text-text hover:scale-110 transition-all"><i data-lucide="skip-forward" size="22" class="fill-current"></i></button>
            </div>

            <div class="flex items-center justify-end w-1/3 gap-4">
                 <button id="pb-cc-btn" onclick="ui.toggleSubtitleDialog()" class="text-subtext0 hover:text-mauve p-2 rounded-lg hover:bg-surface0 transition-colors hidden">
                    <i data-lucide="closed-caption" size="20"></i>
                </button>
                 <button onclick="ui.toggleQueueDialog()" class="text-subtext0 hover:text-mauve relative p-2 rounded-lg hover:bg-surface0 transition-colors">
                    <i data-lucide="list-music" size="20"></i>
                </button>
                <button onclick="player.stop()" class="hidden md:block text-subtext0 hover:text-red relative p-2 rounded-lg hover:bg-surface0 transition-colors">
                    <i data-lucide="x" size="20"></i>
                </button>
            </div>
        </div>
    </div>

    <div id="expanded-player" class="fixed inset-0 bg-base z-50 flex flex-col translate-y-full transition-transform duration-300">
        <div class="h-16 flex items-center justify-between px-6 shrink-0">
            <button onclick="ui.toggleExpanded()" class="p-2 text-subtext0 hover:text-text hover:bg-surface0 rounded-full"><i data-lucide="chevron-down" size="28"></i></button>
            <span class="text-xs font-bold tracking-widest text-overlay0 uppercase">Now Playing</span>
            <div class="flex items-center gap-2">
                <button id="ep-copy-url" type="button" class="p-2 text-subtext0 hover:text-text hidden" title="Copy stream URL"><i data-lucide="copy" size="24"></i></button>
                <button id="ep-fullscreen-btn" onclick="ui.toggleFullscreen()" class="p-2 text-subtext0 hover:text-text" aria-disabled="false"><i data-lucide="monitor-play" size="24"></i></button>
                <button onclick="player.stop()" class="p-2 text-subtext0 hover:text-red transition-colors"><i data-lucide="x" size="24"></i></button>
            </div>
        </div>
        
        <div class="flex-1 flex items-center justify-center p-2 md:p-4 relative overflow-hidden bg-gradient-to-b from-base to-mantle">
            <img id="ep-image" src="" class="max-w-full max-h-full w-full h-full object-contain rounded shadow-2xl hidden z-30">
            <video id="ep-video" class="max-w-full max-h-full rounded shadow-2xl hidden z-30" playsinline></video>
            
            <div id="ep-audio-art" class="w-full max-w-sm aspect-square bg-surface0 rounded-2xl shadow-2xl overflow-hidden relative hidden ring-1 ring-white/10 z-30">
                <!-- Expanded Fallback Icon -->
                <div class="absolute inset-0 flex items-center justify-center text-overlay0 z-0">
                    <i id="ep-fallback-icon" data-lucide="music" size="64"></i>
                </div>
                <img id="ep-art-img" src="" class="absolute inset-0 w-full h-full object-cover z-10 transition-opacity duration-300" onerror="this.style.opacity='0'">
            </div>
        </div>
        
        <div class="pb-6 pt-4 px-4 md:px-8 bg-mantle border-t border-white/5">
            <div class="w-full max-w-full md:max-w-4xl mx-auto space-y-4">
                <div class="text-center">
                    <h2 id="ep-title" class="text-base md:text-lg font-bold text-text break-words px-2">Title</h2>
                    <p id="ep-meta" class="text-xs md:text-sm text-mauve mt-0.5">Artist</p>
                </div>
                <div id="ep-seek-container" class="flex flex-col md:flex-row items-center gap-3 md:gap-4">
                    <!-- Desktop: Controls on one line -->
                    <div id="ep-desktop-controls" class="hidden md:flex items-center gap-2 md:gap-4 flex-1 min-w-0">
                        <button onclick="player.prev()" class="text-text hover:scale-110 transition shrink-0"><i data-lucide="skip-back" size="24" class="fill-current"></i></button>
                        <button onclick="player.toggle()" class="text-text hover:scale-110 transition shrink-0">
                            <i id="ep-play-icon-desktop" data-lucide="play" size="36" class="fill-current"></i>
                        </button>
                        <button onclick="player.next()" class="text-text hover:scale-110 transition shrink-0"><i data-lucide="skip-forward" size="24" class="fill-current"></i></button>
                        <span id="ep-time-curr" class="text-xs font-mono text-subtext0 shrink-0 whitespace-nowrap">0:00</span>
                        <div id="ep-range-wrapper" class="flex-1 min-w-0">
                            <div id="ep-range-fill"></div>
                            <input id="ep-range" type="range" min="0" max="100" value="0">
                        </div>
                        <span id="ep-time-total" class="text-xs font-mono text-subtext0 shrink-0 whitespace-nowrap">0:00</span>
                    </div>
                    <!-- Mobile: Seek bar first (ball and progress together) -->
                    <div id="ep-mobile-seek" class="flex md:hidden items-center gap-2 w-full">
                        <span id="ep-time-curr-mob" class="text-xs font-mono text-subtext0 shrink-0">0:00</span>
                        <div id="ep-range-wrapper-mob" class="flex-1">
                            <div id="ep-range-fill-mob"></div>
                            <input id="ep-range-mob" type="range" min="0" max="100" value="0" class="w-full">
                        </div>
                        <span id="ep-time-total-mob" class="text-xs font-mono text-subtext0 shrink-0">0:00</span>
                    </div>
                    <!-- Mobile: Controls and playlist button centered below seek bar -->
                    <div id="ep-mobile-controls" class="flex md:hidden items-center gap-4 justify-center w-full">
                        <button onclick="player.prev()" class="text-text hover:scale-110 transition shrink-0"><i data-lucide="skip-back" size="24" class="fill-current"></i></button>
                        <button onclick="player.toggle()" class="text-text hover:scale-110 transition shrink-0">
                            <i id="ep-play-icon" data-lucide="play" size="36" class="fill-current"></i>
                        </button>
                        <button onclick="player.next()" class="text-text hover:scale-110 transition shrink-0"><i data-lucide="skip-forward" size="24" class="fill-current"></i></button>
                        <button id="ep-cc-btn-mob" onclick="ui.toggleSubtitleDialog()" class="text-subtext0 hover:text-mauve shrink-0 hidden"><i data-lucide="closed-caption" size="20"></i></button>
                        <button onclick="ui.toggleQueueDialog()" class="text-subtext0 hover:text-mauve shrink-0"><i data-lucide="list-music" size="20"></i></button>
                    </div>
                    <!-- Desktop: CC and Playlist buttons -->
                    <button id="ep-cc-btn-desktop" onclick="ui.toggleSubtitleDialog()" class="hidden max-md:hidden md:flex text-subtext0 hover:text-mauve shrink-0"><i data-lucide="closed-caption" size="20"></i></button>
                    <button id="ep-desktop-playlist" onclick="ui.toggleQueueDialog()" class="hidden md:block text-subtext0 hover:text-mauve shrink-0"><i data-lucide="list-music" size="20"></i></button>
                </div>
            </div>
        </div>
    </div>

    <div id="fullscreen-video-container" class="fixed inset-0 bg-black z-[60] hidden">
        <div id="fv-shell" class="relative w-full h-full bg-black flex items-center justify-center">
            <div id="fv-video-slot" class="w-full h-full flex items-center justify-center bg-black"></div>
            <div id="fv-controls" class="absolute inset-0 z-50 flex flex-col justify-end p-4 gap-4 bg-gradient-to-t from-black/80 via-black/40 to-transparent">
                <div class="flex items-center gap-3">
                    <span id="fv-time-curr" class="text-xs font-mono text-white/80 shrink-0">0:00</span>
                    <div id="fv-range-wrapper" class="flex-1">
                        <div id="fv-range-fill"></div>
                        <input id="fv-range" type="range" min="0" max="100" value="0">
                    </div>
                    <span id="fv-time-total" class="text-xs font-mono text-white/80 shrink-0">0:00</span>
                </div>
                <div class="flex items-center gap-4 justify-center">
                    <button id="fv-back" class="p-3 rounded-full bg-white/10 text-white hover:bg-white/20 transition"><i data-lucide="rewind" size="22"></i></button>
                    <button id="fv-play" class="p-3 rounded-full bg-white/20 text-white hover:bg-white/30 transition"><i id="fv-play-icon" data-lucide="play" size="28"></i></button>
                    <button id="fv-forward" class="p-3 rounded-full bg-white/10 text-white hover:bg-white/20 transition"><i data-lucide="fast-forward" size="22"></i></button>
                    <button id="fv-exit" class="px-3 py-2 rounded-lg bg-white/10 text-white hover:bg-white/20 transition">Exit</button>
                </div>
            </div>
        </div>
    </div>

    <div id="fullscreen-image-container" class="fixed inset-0 bg-black z-[60] hidden flex items-center justify-center">
        <img id="fullscreen-image" src="" class="max-w-full max-h-full w-full h-full object-contain">
    </div>

    <script src="/static/js/hls.min.js"></script>
    <script type="module" src="/js/app.js"></script>
    <script>
        // Initialize Lucide icons
        lucide.createIcons();
    </script>
</body>
</html>
